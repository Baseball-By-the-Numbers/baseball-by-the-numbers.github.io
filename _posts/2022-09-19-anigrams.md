---
layout: post
published: false
title:  
date: 2018/04/21
subtitle:
tags:
---

>**Question:**

<!--more-->

([FiveThirtyEight](URL))

## Solution

The sketch below shows the potential sequence of plays for a winning game of anigrams on the left, and the underlying game on the right. For any given stage, there may be multiple words that can be formed from the letter set.

![](/img/2022-09-19-words-to-barcodes.png){:width="300 px" class="image-centered"}

<!-- To build a valid game of anigrams, we need to find a list of $9$ letters that form a word, and remove letters from the list, one at a time, such that at least one real word can be formed at each stage. -->

To build a valid game of anigrams, we just need to pick a sequence of $4$ letters, and add letters one at a time, such that at every stage, at least one real word can be formed from the letters.

# Algorithm

This suggests an efficient way to build anigram games. First, we turn every $4$ letter word into a unique barcode and add it to a set `good_barcodes`. Then, we go through each $5$ letter word, removing one letter at a time to form the barcodes that could have preceded it, and check if any of those are in the set of `good_barcodes`. If at least one is, then we barcode that $5$ letter word, and add its barcode to the list of `good_barcodes`. This ensures that the only barcodes in the set are those that have an ancestor in the set.

At the end of this process, the longest barcode(s) in `good_barcodes` will be the anigram game(s) we're looking for. Knowing that the game exists is one thing, but we'd also like to be able to efficiently recreate it. To do this, we'll log the valid sub-words for each word in the map `precursors`.


# Coding

To start, we write a function to turn any word into the corresponding barcode

```python
def word_to_barcode(word):
  return "".join(sorted(word))
```

and initialize the set `good_barcodes`

```python
initial_words = [word for word in words if len(word) == 4]
```

To be able to easily convert from barcodes back to words, we make a map from barcodes to words

```python
from typing_extensions import DefaultDict
barcode_to_word = DefaultDict()

for word in words:
  barcode_to_word[word_to_barcode(word)] = word
```

Now, we make a linear pass over the list to build the set `good_barcodes`

```python
# keep track of which words have sub-barcodes
good_barcodes = set(word_to_barcode(word) for word in initial_words)

# store precursor words
precursors = DefaultDict(lambda: set())

for word in words:
  
  # make potential precursor barcodes for each word by removing each letter
  sub_word_barcodes = [word_to_barcode(word[0:i-1] + word[i:]) for i in range(1, len(word)+1)]
  
  # loop over the potential sub-barcodes to see if any already exist in good_barcodes
  # if so, add current barcode to good_barcodes, log sample sub-word in precursors
  for sub_word_barcode in sub_word_barcodes:
  
    if sub_word_barcode in good_barcodes:
      good_barcodes.add(word_to_barcode(word))
      precursors[word].add(barcode_to_word[sub_word_barcode])
 ```
 
 With this in hand, we can simply find the barcodes of maximum length
 
 ```python
longest = max(good_barcodes, key=lambda x: len(x))
longest_barcodes = [barcode for barcode in good_barcodes if len(barcode) == len(longest)]
longest_words = [word for word in words if word_to_barcode(word) in longest_barcodes]
list(zip(longest_barcodes, longest_words))
```

which produces 

```python
[('adeeiiimnnnorstt', 'indeterminations'),
 ('adeeiimnnorssttu', 'underestimations')]
```

So, there are two longest anigram games, ending in the $16$-letter words `indeterminations` and `underestimations`.

We can walk backwards through precursors to resurrect sample gameplay. 

For `indeterminations`:

```python
['indeterminations',
 'intermediations',
 'determinations',
 'antimodernist',
 'terminations',
 'nitrosamine',
 'antinomies',
 'nominates',
 'sonatine',
 'stanine',
 'anenst',
 'anent',
 'neat']
 ```
 
 and for `underestimations`:
 
 ```python
 ['underestimations',
 'underestimation',
 'determinations',
 'antimodernist',
 'terminations',
 'nitrosamine',
 'antinomies',
 'nominates',
 'sonatine',
 'stanine',
 'anenst',
 'anent',
 'neat']
 ```
 
The games are identical up until the second to last word, where adding a `u` or an `i` is the determining step. At the outer limits of the game, we should expect an exceptional sequence of mutations, so maybe it's not so surprising that the two longest games have the same origin.

# Extra credit




<br>

<!-- 2022-09-19-words-to-barcodes.png -->
